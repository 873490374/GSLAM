<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>GSLAM: Svar: A Tiny Modern C++ Header Brings Unified Interface for Different Languages</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logosmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GSLAM
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Svar: A Tiny Modern C++ Header Brings Unified Interface for Different Languages </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Svar is a part of GSLAM, but also is a separate project: <a href="https://github.com/zdzhaoyong/Svar">https://github.com/zdzhaoyong/Svar</a></p>
<p>By Using Svar, your C++ library can be called easily with different languages like C++, Java, Python and Javascript.</p>
<p>Svar brings the following features:</p>
<ul>
<li>A dynamic link library that can be used as a module in languages such as C++, Python, and Node-JS;</li>
<li>Unified C++ library interface, which can be called as a plug-in module. The released library comes with documentation, making *.h header file interface description unnecessary;</li>
<li>Dynamic features. It wraps variables, functions, and classes into Svar while maintaining efficiency;</li>
<li>Built-in Json support, parameter configuration parsing, thread-safe reading and writing, data decoupling sharing between modules, etc.</li>
</ul>
<h1><a class="anchor" id="s_svar_json"></a>
Use Svar like JSON</h1>
<p>Svar natually support JSON and here is some basic usage demo: </p><div class="fragment"><div class="line">Svar null=<span class="keyword">nullptr</span>;</div><div class="line">Svar b=<span class="keyword">false</span>;</div><div class="line">Svar i=1;</div><div class="line">Svar d=2.1;</div><div class="line">Svar s=<span class="stringliteral">&quot;hello world&quot;</span>;</div><div class="line">Svar v={1,2,3}</div><div class="line">Svar m={<span class="stringliteral">&quot;b&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;s&quot;</span>,<span class="stringliteral">&quot;hello world&quot;</span>}</div><div class="line"></div><div class="line">Svar obj;</div><div class="line">obj[<span class="stringliteral">&quot;m&quot;</span>]=m;</div><div class="line">obj[<span class="stringliteral">&quot;pi&quot;</span>]=3.14159;</div><div class="line"></div><div class="line">std::cout&lt;&lt;obj;</div><div class="line"></div><div class="line">std::stringstream sst(<span class="stringliteral">&quot;[2,3,4]&quot;</span>);</div><div class="line">sst&gt;&gt;obj;</div><div class="line">std::cout&lt;&lt;obj;</div><div class="line"></div><div class="line"><span class="comment">// use string literal</span></div><div class="line">Svar lit=<span class="stringliteral">&quot;[false,3]&quot;</span>_svar;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span>(s.is&lt;std::string&gt;()) <span class="comment">// use is to check type</span></div><div class="line">    std::cout&lt;&lt;<span class="stringliteral">&quot;raw string is &quot;</span>&lt;&lt;s.as&lt;std::string&gt;(); <span class="comment">// use as to force cast, never throw</span></div><div class="line"></div><div class="line"><span class="keywordtype">double</span> d=i.castAs&lt;<span class="keywordtype">double</span>&gt;();<span class="comment">// use castAs, this may throw SvarException</span></div></div><!-- fragment --><h1><a class="anchor" id="s_svar_arguments"></a>
Use Svar for Argument Parsing</h1>
<p>Svar provides argument parsing functional with JSON configuration loading. Here is a small demo shows how to use Svar for argument parsing:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;GSLAM/core/Svar.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    svar.parseMain(argc,argv);</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> argInt=svar.arg&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;i&quot;</span>,0,<span class="stringliteral">&quot;This is a demo int parameter&quot;</span>);</div><div class="line">    svar.arg&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;b&quot;</span>,<span class="keyword">false</span>,<span class="stringliteral">&quot;Here is the bool description&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(svar.get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;help&quot;</span>,<span class="keyword">false</span>)){</div><div class="line">        svar.help();</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>When you use "--help" or "-help", the terminal should show the below introduction: </p><div class="fragment"><div class="line">-&gt; sample_use --help</div><div class="line">Usage:</div><div class="line">sample_use [--help] [-conf configure_file] [-arg_name arg_value]...</div><div class="line"></div><div class="line">Using Svar supported argument parsing. The following table listed several argume</div><div class="line">nt introductions.</div><div class="line"></div><div class="line">Argument        Type(default-&gt;setted)           Introduction</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">-i              <span class="keywordtype">int</span>(0)                          This is a demo <span class="keywordtype">int</span> parameter</div><div class="line">-b              <span class="keywordtype">bool</span>(false)                     Here is the <span class="keywordtype">bool</span> description</div><div class="line">-conf           str(&quot;Default.cfg&quot;)              The default configure file going</div><div class="line">                                                 to parse.</div><div class="line">-help           <span class="keywordtype">bool</span>(false-&gt;true)               Show the help information.</div></div><!-- fragment --><p> "help" and "conf" is two default parameters and users can use "conf" to load JSON file for configuration loading.</p>
<p>Svar supports the following parsing styles:</p><ul>
<li>"-arg value": two '-' such as "--arg value" is the same</li>
<li>"-arg=value": two "--" such as "--arg=value" is the same</li>
<li>"arg=value"</li>
<li>"-arg" : this is the same with "arg=true", but the next argument should not be a value</li>
</ul>
<h1><a class="anchor" id="s_svar_cppelements"></a>
Use Svar to Hold Other C++ Elements</h1>
<p>Svar can not only hold JSON types, but also any other c++ elements including functions, classes and objects.</p>
<h2><a class="anchor" id="s_svar_cppelements_sample"></a>
A tiny sample of Svar holding functions and classes.</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;GSLAM/core/Svar.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> c_func(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b){<span class="keywordflow">return</span> a+b;}</div><div class="line"></div><div class="line"><span class="keyword">class </span>DemoClass{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    DemoClass(<span class="keyword">const</span> std::string&amp; name):_name(name){}</div><div class="line">    std::string getName()<span class="keyword">const</span>{<span class="keywordflow">return</span> _name;}</div><div class="line">    <span class="keywordtype">void</span> setName(std::string name){_name=name}</div><div class="line"></div><div class="line">    <span class="keyword">static</span> DemoClass create(std::string name){<span class="keywordflow">return</span> DemoClass(name);}</div><div class="line"></div><div class="line">    std::string _name;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    Svar add=c_func;<span class="comment">// hold a function</span></div><div class="line">    <span class="keywordtype">int</span>  c=add(a,b).castAs&lt;<span class="keywordtype">int</span>&gt;();<span class="comment">// use the function</span></div><div class="line"></div><div class="line">    Svar create(&amp;DemoClass::create);<span class="comment">// hold a static member function</span></div><div class="line">    DemoClass inst=create(<span class="stringliteral">&quot;hello svar&quot;</span>).as&lt;DemoClass&gt;();<span class="comment">// call a static member function</span></div><div class="line"></div><div class="line">    Svar(&amp;DemoClass::setName)(&amp;inst,<span class="stringliteral">&quot;I changed name&quot;</span>);<span class="comment">// call a member function</span></div><div class="line"></div><div class="line">    Svar cls=SvarClass::instance&lt;DemoClass&gt;();</div><div class="line">    Class&lt;DemoClass&gt;()</div><div class="line">        .construct&lt;const std::string&amp;&gt;()</div><div class="line">        .def(<span class="stringliteral">&quot;getName&quot;</span>,&amp;DemoClass::getName)</div><div class="line">        .def(<span class="stringliteral">&quot;setName&quot;</span>,&amp;DemoClass::setName)</div><div class="line">        .def_static(<span class="stringliteral">&quot;create&quot;</span>,&amp;DemoClass::create)</div><div class="line">        .def_readwrite(<span class="stringliteral">&quot;name&quot;</span>,&amp;DemoClass::_name);</div><div class="line"></div><div class="line">    Svar inst2=cls(<span class="stringliteral">&quot;I am another instance&quot;</span>);<span class="comment">// construct a instance</span></div><div class="line">    std::string name=inst2.call(<span class="stringliteral">&quot;getName&quot;</span>).as&lt;std::string&gt;();</div><div class="line">    inst2.call(<span class="stringliteral">&quot;setName&quot;</span>,<span class="stringliteral">&quot;changed name with svar&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="s_svar_class"></a>
Define Class Members with Svar</h2>
<p>Svar does not do magic, so users need to bind functions mannually like boost or pybind11 did. Fortunately, Svar provided utils to bind those functions very conveniencely.</p>
<p>As used in last section, there are three types of functions: constructor, member function and static member function. And Svar also support lambda expression of functions so that users able to extend functions more easily. </p><div class="fragment"><div class="line">Class&lt;DemoClass&gt;(<span class="stringliteral">&quot;Demo&quot;</span>)             <span class="comment">// change the name to Demo</span></div><div class="line">    .construct&lt;const std::string&amp;&gt;() <span class="comment">// constructor</span></div><div class="line">    .def(<span class="stringliteral">&quot;getName&quot;</span>,&amp;DemoClass::getName) <span class="comment">// const member function</span></div><div class="line">    .def(<span class="stringliteral">&quot;setName&quot;</span>,&amp;DemoClass::setName) <span class="comment">// member function</span></div><div class="line">    .def_static(<span class="stringliteral">&quot;create&quot;</span>,&amp;DemoClass::create)<span class="comment">// static function</span></div><div class="line">    .def(<span class="stringliteral">&quot;print&quot;</span>,[](DemoClass&amp; <span class="keyword">self</span>){std::cerr&lt;&lt;<span class="keyword">self</span>._name;})<span class="comment">// lambda function</span></div><div class="line">    .def_static(<span class="stringliteral">&quot;none&quot;</span>,[](){});<span class="comment">// static lambda function</span></div></div><!-- fragment --><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Svar does not support field now, maybe it's a future work.</dd></dl>
<h2><a class="anchor" id="s_svar_operators"></a>
Operators of Svar</h2>
<p>Svar supports to call functions with operators, such as for int, we got some math operators and we want to use it directly with Svar: </p><div class="fragment"><div class="line">Svar a=4;</div><div class="line">Svar b=5;</div><div class="line"><span class="keyword">auto</span> c=a+b;</div><div class="line">EXPECT_TRUE(c.is&lt;<span class="keywordtype">int</span>&gt;())</div><div class="line">EXPECT_EQ(c,20)</div></div><!-- fragment --><p>The above operation is available because Svar builtin defined as following: </p><div class="fragment"><div class="line">SvarClass::Class&lt;int&gt;()</div><div class="line">.def(<span class="stringliteral">&quot;__init__&quot;</span>,&amp;SvarBuiltin::int_create)</div><div class="line">.def(<span class="stringliteral">&quot;__double__&quot;</span>,[](<span class="keywordtype">int</span> i){<span class="keywordflow">return</span> (<span class="keywordtype">double</span>)i;})</div><div class="line">.def(<span class="stringliteral">&quot;__bool__&quot;</span>,[](<span class="keywordtype">int</span> i){<span class="keywordflow">return</span> (<span class="keywordtype">bool</span>)i;})</div><div class="line">.def(<span class="stringliteral">&quot;__str__&quot;</span>,[](<span class="keywordtype">int</span> i){<span class="keywordflow">return</span> Svar::toString(i);})</div><div class="line">.def(<span class="stringliteral">&quot;__eq__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,<span class="keywordtype">int</span> rh){<span class="keywordflow">return</span> <span class="keyword">self</span>==rh;})</div><div class="line">.def(<span class="stringliteral">&quot;__lt__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,<span class="keywordtype">int</span> rh){<span class="keywordflow">return</span> <span class="keyword">self</span>&lt;rh;})</div><div class="line">.def(<span class="stringliteral">&quot;__add__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,Svar rh)-&gt;Svar{</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">int</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>+rh.as&lt;<span class="keywordtype">int</span>&gt;());</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">double</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>+rh.as&lt;<span class="keywordtype">double</span>&gt;());</div><div class="line">    <span class="keywordflow">return</span> Svar::Undefined();</div><div class="line">})</div><div class="line">.def(<span class="stringliteral">&quot;__sub__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,Svar rh)-&gt;Svar{</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">int</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>-rh.as&lt;<span class="keywordtype">int</span>&gt;());</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">double</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>-rh.as&lt;<span class="keywordtype">double</span>&gt;());</div><div class="line">    <span class="keywordflow">return</span> Svar::Undefined();</div><div class="line">})</div><div class="line">.def(<span class="stringliteral">&quot;__mul__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,Svar rh)-&gt;Svar{</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">int</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>*rh.as&lt;<span class="keywordtype">int</span>&gt;());</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">double</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>*rh.as&lt;<span class="keywordtype">double</span>&gt;());</div><div class="line">    <span class="keywordflow">return</span> Svar::Undefined();</div><div class="line">})</div><div class="line">.def(<span class="stringliteral">&quot;__div__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,Svar rh){</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">int</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>/rh.as&lt;<span class="keywordtype">int</span>&gt;());</div><div class="line">    <span class="keywordflow">if</span>(rh.is&lt;<span class="keywordtype">double</span>&gt;()) <span class="keywordflow">return</span> Svar(<span class="keyword">self</span>/rh.as&lt;<span class="keywordtype">double</span>&gt;());</div><div class="line">    <span class="keywordflow">return</span> Svar::Undefined();</div><div class="line">})</div><div class="line">.def(<span class="stringliteral">&quot;__mod__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,<span class="keywordtype">int</span> rh){</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">self</span>%rh;</div><div class="line">})</div><div class="line">.def(<span class="stringliteral">&quot;__neg__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>){<span class="keywordflow">return</span> -<span class="keyword">self</span>;})</div><div class="line">.def(<span class="stringliteral">&quot;__xor__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,<span class="keywordtype">int</span> rh){<span class="keywordflow">return</span> <span class="keyword">self</span>^rh;})</div><div class="line">.def(<span class="stringliteral">&quot;__or__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,<span class="keywordtype">int</span> rh){<span class="keywordflow">return</span> <span class="keyword">self</span>|rh;})</div><div class="line">.def(<span class="stringliteral">&quot;__and__&quot;</span>,[](<span class="keywordtype">int</span> <span class="keyword">self</span>,<span class="keywordtype">int</span> rh){<span class="keywordflow">return</span> <span class="keyword">self</span>&amp;rh;});</div></div><!-- fragment --><p>If you want your own class support these operators, you need to define you own implementations. The following table listed some operators that often used.</p>
<table class="doxtable">
<tr>
<th>Operator </th><th>Function Name  </th></tr>
<tr>
<td>+ </td><td>"__add__" </td></tr>
<tr>
<td>- </td><td>"__sub__" </td></tr>
<tr>
<td>* </td><td>"__mul__" </td></tr>
<tr>
<td>/ </td><td>"__div__" </td></tr>
<tr>
<td>% </td><td>"__mod__" </td></tr>
<tr>
<td>&amp; </td><td>"__and__" </td></tr>
<tr>
<td>| </td><td>"__or__" </td></tr>
<tr>
<td>^ </td><td>"__xor__" </td></tr>
<tr>
<td>= </td><td>"__eq__" </td></tr>
<tr>
<td>!= </td><td>"__nq__" </td></tr>
<tr>
<td>&lt; </td><td>"__lt__" </td></tr>
<tr>
<td>&gt; </td><td>"__gt__" </td></tr>
<tr>
<td>&lt;= </td><td>"__le__" </td></tr>
<tr>
<td>&gt;= </td><td>"__ge__" </td></tr>
<tr>
<td>[] </td><td>"__getitem__" </td></tr>
</table>
<h2><a class="anchor" id="s_svar_inherit"></a>
Inherit of Classes</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;GSLAM/core/Svar.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceGSLAM.html">GSLAM</a>;</div><div class="line"></div><div class="line"><span class="keyword">class </span>BBase{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> isBBase(){<span class="keywordflow">return</span> <span class="keyword">true</span>;}</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>BaseClass: <span class="keyword">public</span> BBase{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    BaseClass(<span class="keywordtype">int</span> age):age_(age){}</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> getAge()<span class="keyword">const</span>{<span class="keywordflow">return</span> age_;}</div><div class="line">    <span class="keywordtype">void</span> setAge(<span class="keywordtype">int</span> a){age_=a;}</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> isBBase(){<span class="keywordflow">return</span> <span class="keyword">false</span>;}</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> age_;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    Class&lt;BBase&gt;()</div><div class="line">        .def(<span class="stringliteral">&quot;isBBase&quot;</span>,&amp;BBase::isBBase);</div><div class="line"></div><div class="line">    Class&lt;BaseClass&gt;()</div><div class="line">        .inherit&lt;BBase,BaseClass&gt;() <span class="comment">// use this to inherit</span></div><div class="line">        .def_static(<span class="stringliteral">&quot;__init__&quot;</span>,[](<span class="keywordtype">int</span> age){<span class="keywordflow">return</span> BaseClass(age);})<span class="comment">// replace construct&lt;int&gt;()</span></div><div class="line">        .def(<span class="stringliteral">&quot;getAge&quot;</span>,&amp;BaseClass::getAge)</div><div class="line">        .def(<span class="stringliteral">&quot;setAge&quot;</span>,&amp;BaseClass::setAge)</div><div class="line">        .def_readwrite(<span class="stringliteral">&quot;age&quot;</span>,&amp;BaseClass::age_);</div><div class="line"></div><div class="line">    <a class="code" href="classGSLAM_1_1Svar.html">Svar</a> cls=SvarClass::instance&lt;BaseClass&gt;();</div><div class="line">    <a class="code" href="classGSLAM_1_1Svar.html">Svar</a> obj=cls(10);<span class="comment">// ten years old?</span></div><div class="line">    assert(!obj.call(<span class="stringliteral">&quot;isBBase).as&lt;bool&gt;());</span></div><div class="line"><span class="stringliteral">    return 0;</span></div><div class="line"><span class="stringliteral">}</span></div></div><!-- fragment --><h1><a class="anchor" id="s_svar_plugin"></a>
Export &amp; Import Svar Module with C++ Shared Library</h1>
<p>One of the most important design target of Svar is to export a shared library that can be used by different languages.</p>
<h2><a class="anchor" id="s_svar_export"></a>
Export Svar Module</h2>
<p>The only thing needs to do is to put what you want to the singleton of Svar: Svar::instance(), which is defined as 'svar', and expose the symbol with macro EXPORT_SVAR_INSTANCE.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;GSLAM/core/Svar.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceGSLAM.html">GSLAM</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> add(<span class="keywordtype">int</span> a,<span class="keywordtype">int</span> b){</div><div class="line">    <span class="keywordflow">return</span> a+b;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">class </span>ApplicationDemo{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ApplicationDemo(std::string name):_name(name){</div><div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Application Created.&quot;</span>;</div><div class="line">    }</div><div class="line">    std::string name()<span class="keyword">const</span>{<span class="keywordflow">return</span> _name;}</div><div class="line">    std::string gslam_version()<span class="keyword">const</span>{<span class="keywordflow">return</span> <span class="stringliteral">&quot;3.2&quot;</span>;}</div><div class="line">    std::string _name;</div><div class="line">};</div><div class="line"></div><div class="line">REGISTER_SVAR_MODULE(sample)<span class="comment">// see, so easy, haha</span></div><div class="line">{</div><div class="line">    svar[<span class="stringliteral">&quot;__name__&quot;</span>]=<span class="stringliteral">&quot;sample_module&quot;</span>;</div><div class="line">    svar[<span class="stringliteral">&quot;__doc__&quot;</span>]=<span class="stringliteral">&quot;This is a demo to show how to export a module using svar.&quot;</span>;</div><div class="line">    svar[<span class="stringliteral">&quot;add&quot;</span>]=add;</div><div class="line"></div><div class="line">    Class&lt;ApplicationDemo&gt;()</div><div class="line">            .construct&lt;std::string&gt;()</div><div class="line">            .def(<span class="stringliteral">&quot;name&quot;</span>,&amp;ApplicationDemo::name)</div><div class="line">            .def(<span class="stringliteral">&quot;gslam_version&quot;</span>,&amp;ApplicationDemo::gslam_version);</div><div class="line"></div><div class="line">    svar[<span class="stringliteral">&quot;ApplicationDemo&quot;</span>]=SvarClass::instance&lt;ApplicationDemo&gt;();</div><div class="line">}</div><div class="line"></div><div class="line">EXPORT_SVAR_INSTANCE <span class="comment">// export the symbol of Svar::instance</span></div></div><!-- fragment --><p>Compile this file to a shared library "libsample.so" or "sample.dll", and we are going to access this module with Svar later.</p>
<h2><a class="anchor" id="s_svar_doc"></a>
Documentation of Svar Module</h2>
<p>A Svar module is designed to be self maintained, which means the module can be called without header or documentation. Since SvarFunction auto generated function signatures, so that users are able to know how to call Svar functions.</p>
<p>One can use the 'svar' application from <a href="https://github.com/zdzhaoyong/Svar,">https://github.com/zdzhaoyong/Svar,</a> or the "gslam" application of <a href="https://github.com/zdzhaoyong/GSLAM">https://github.com/zdzhaoyong/GSLAM</a> to access the context.</p>
<div class="fragment"><div class="line">-&gt; gslam doc -plugin sample</div><div class="line">{</div><div class="line">  <span class="stringliteral">&quot;ApplicationDemo&quot;</span> : &lt;<span class="keyword">class </span>at 0x15707d0&gt;,</div><div class="line">  &quot;__builtin__&quot; : {</div><div class="line">    <span class="stringliteral">&quot;Json&quot;</span> : &lt;<span class="keyword">class </span>at 0x156fd80&gt;,</div><div class="line">    &quot;version&quot; : 256</div><div class="line">  },</div><div class="line">  &quot;__doc__&quot; : &quot;This is a demo to show how to export a module using svar.&quot;,</div><div class="line">  &quot;__name__&quot; : &quot;sample_module&quot;,</div><div class="line">  &quot;add&quot; : &lt;function at 0x15706e0&gt;</div><div class="line">}</div><div class="line">-&gt; gslam doc -plugin sample -key ApplicationDemo</div><div class="line">class ApplicationDemo():</div><div class="line">|  ApplicationDemo.__init__(...)</div><div class="line">|      ApplicationDemo.__init__(str)-&gt;ApplicationDemo</div><div class="line">|</div><div class="line">|</div><div class="line">|  Methods defined here:</div><div class="line">|  ApplicationDemo.__init__(...)</div><div class="line">|      ApplicationDemo.__init__(str)-&gt;ApplicationDemo</div><div class="line">|</div><div class="line">|</div><div class="line">|  ApplicationDemo.gslam_version(...)</div><div class="line">|      ApplicationDemo.gslam_version(ApplicationDemo const*)-&gt;str</div><div class="line">|</div><div class="line">|</div><div class="line">|  ApplicationDemo.name(...)</div><div class="line">|      ApplicationDemo.name(ApplicationDemo const*)-&gt;str</div><div class="line">|</div><div class="line">|</div></div><!-- fragment --><h2><a class="anchor" id="s_svar_usecpp"></a>
Use Svar Module in C++</h2>
<p>We are able to load the Svar instance exported by marco with EXPORT_SVAR_INSTANCE using Registry::load().</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;GSLAM/core/Svar.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;GSLAM/core/Registry.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceGSLAM.html">GSLAM</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc,<span class="keywordtype">char</span>** argv){</div><div class="line">    <a class="code" href="classGSLAM_1_1Svar.html">Svar</a> sampleModule=Registry::load(<span class="stringliteral">&quot;sample&quot;</span>);</div><div class="line"></div><div class="line">    <a class="code" href="classGSLAM_1_1Svar.html">Svar</a> ApplicationDemo=sampleModule[<span class="stringliteral">&quot;ApplicationDemo&quot;</span>];</div><div class="line"></div><div class="line">    <a class="code" href="classGSLAM_1_1Svar.html">Svar</a> instance=ApplicationDemo(<span class="stringliteral">&quot;zhaoyong&quot;</span>);</div><div class="line">    std::cout&lt;&lt;instance.<a class="code" href="classGSLAM_1_1Svar.html#a244e9f10e4f3959a160118e2acf9cd10">call</a>(<span class="stringliteral">&quot;gslam_version&quot;</span>);</div><div class="line"></div><div class="line">    std::cout&lt;&lt;ApplicationDemo.<a class="code" href="classGSLAM_1_1Svar.html#a08773c77163453a2ce55b7145e3c7ba8">as</a>&lt;SvarClass&gt;();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
