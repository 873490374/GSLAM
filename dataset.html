<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>GSLAM: Dataset Plugin for GSLAM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logosmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GSLAM
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Dataset Plugin for GSLAM </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Goal of GSLAM Dataset is to unify the SLAM input.</p>
<p>Several popular datasets are implemented for now and it is also very easy to extend a user defined dataset.</p>
<h1><a class="anchor" id="sDatasetPlay"></a>
Play a Dataset</h1>
<p>To play and visualize a dataset, please use: </p><div class="fragment"><div class="line">gslam qviz play -dataset &lt;dataset_path&gt;/dataset_name.&lt;dataset_ext&gt;</div></div><!-- fragment --><p>It should be noted that '&lt;dataset_path&gt;/dataset_name.&lt;dataset_ext&gt;' does not always have to be a file. The extension is essential just for idendify the correct dataset plugin.</p>
<h1><a class="anchor" id="sDataset"></a>
Implement a Dataset Plugin</h1>
<p>To implement a Dataset of your own, please learn from the Euroc Dataset implementation:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;GSLAM/core/GSLAM.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;opencv2/highgui/highgui.hpp&gt;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">   1. Download dataset from : https://projects.asl.ethz.ch/datasets/doku.php?id=kmavvisualinertialdatasets</span></div><div class="line"><span class="comment">   2. Play dataset with gslam qviz -dataset &lt;dir&gt;/MH_01_easy/mav0/mono.euroc</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceGSLAM.html">GSLAM</a> {</div><div class="line"></div><div class="line"><span class="keyword">class </span>FrameIMUEuroc : <span class="keyword">public</span> MapFrame</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    FrameIMUEuroc(FrameID <span class="keywordtype">id</span>,<span class="keywordtype">double</span> time,</div><div class="line">             Point3d acc ,Point3d angularV,</div><div class="line">             Point3d accN,Point3d gyrN,SE3 imu2body=SE3())</div><div class="line">           : MapFrame(id,time),</div><div class="line">             _acc(acc),_angularV(angularV),</div><div class="line">             _accN(accN),_gyrN(gyrN),_i2b(imu2body){}</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> std::string type()<span class="keyword"> const</span>{<span class="keywordflow">return</span> <span class="stringliteral">&quot;FrameIMU&quot;</span>;}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span>     getIMUNum()<span class="keyword">const</span>{<span class="keywordflow">return</span> 1;}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span>    getAcceleration(Point3d&amp; acc,<span class="keywordtype">int</span> idx=0)<span class="keyword">const</span>{acc=_acc;<span class="keywordflow">return</span> <span class="keyword">true</span>;}        <span class="comment">// m/s^2</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span>    getAccelerationNoise(Point3d &amp;accN, <span class="keywordtype">int</span> idx)<span class="keyword"> const</span>{accN=_accN;<span class="keywordflow">return</span> <span class="keyword">true</span>;}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span>    getAngularVelocity(Point3d&amp; angularV,<span class="keywordtype">int</span> idx=0)<span class="keyword">const</span>{angularV=_angularV;<span class="keywordflow">return</span> <span class="keyword">true</span>;}<span class="comment">// rad/s</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span>    getAngularVNoise(Point3d &amp;angularVN, <span class="keywordtype">int</span> idx)<span class="keyword"> const</span>{angularVN=_gyrN;<span class="keywordflow">return</span> <span class="keyword">true</span>;}</div><div class="line"></div><div class="line">    Point3d _acc,_angularV,_accN,_gyrN;</div><div class="line">    SE3     _i2b;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>FrameMonoEuroc : <span class="keyword">public</span> MapFrame</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    FrameMonoEuroc(FrameID <span class="keywordtype">id</span>,<span class="keywordtype">double</span> time,</div><div class="line">                   <span class="keyword">const</span> GImage&amp; img,<span class="keyword">const</span> Camera&amp; camera,</div><div class="line">                   <span class="keyword">const</span> SE3&amp; camera2body)</div><div class="line">        : MapFrame(id,time),_imgLeft(img),_camLeft(camera),_c2bLeft(camera2body){}</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> std::string type()<span class="keyword"> const</span>{<span class="keywordflow">return</span> <span class="stringliteral">&quot;FrameMonoEuroc&quot;</span>;}</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span>    cameraNum()<span class="keyword">const</span>{<span class="keywordflow">return</span> 1;}     <span class="comment">// Camera number</span></div><div class="line">    <span class="keyword">virtual</span> GImage getImage(<span class="keywordtype">int</span> idx,<span class="keywordtype">int</span> channels){<span class="keywordflow">return</span> _imgLeft;} <span class="comment">// 0:origin image</span></div><div class="line">    <span class="keyword">virtual</span> Camera getCamera(<span class="keywordtype">int</span> idx=0){<span class="keywordflow">return</span> _camLeft;}</div><div class="line">    <span class="keyword">virtual</span> SE3    getCameraPose(<span class="keywordtype">int</span> idx)<span class="keyword"> const</span>{<span class="keywordflow">return</span> _c2bLeft;}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span>    imageChannels(<span class="keywordtype">int</span> idx=0)<span class="keyword"> const</span>{<span class="keywordflow">return</span> IMAGE_GRAY;}</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    GImage       _imgLeft;</div><div class="line">    Camera       _camLeft;</div><div class="line">    SE3          _c2bLeft;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>FrameStereoEuroc : <span class="keyword">public</span> FrameMonoEuroc{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    FrameStereoEuroc(FrameID <span class="keywordtype">id</span>,<span class="keywordtype">double</span> timestamp,</div><div class="line">                     <span class="keyword">const</span> GImage&amp; imgLeft,<span class="keyword">const</span> GImage&amp; imgRight,</div><div class="line">                     <span class="keyword">const</span> Camera&amp; cameraLeft,<span class="keyword">const</span> Camera&amp; cameraRight,</div><div class="line">                     <span class="keyword">const</span> SE3&amp;    poseLeft,<span class="keyword">const</span> SE3&amp; poseRight)</div><div class="line">        : FrameMonoEuroc(id,timestamp,imgLeft,cameraLeft,poseLeft),</div><div class="line">          _imgRight(imgRight),_camRight(cameraRight),_c2bRight(poseRight){}</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> std::string type()<span class="keyword"> const</span>{<span class="keywordflow">return</span> <span class="stringliteral">&quot;FrameStereoEuroc&quot;</span>;}</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span>    cameraNum()<span class="keyword">const</span>{<span class="keywordflow">return</span> 2;}     <span class="comment">// Camera number</span></div><div class="line">    <span class="keyword">virtual</span> GImage getImage(<span class="keywordtype">int</span> idx,<span class="keywordtype">int</span> channels){<span class="keywordflow">return</span> idx==0?_imgLeft:_imgRight;} <span class="comment">// 0:origin image</span></div><div class="line">    <span class="keyword">virtual</span> Camera getCamera(<span class="keywordtype">int</span> idx=0){<span class="keywordflow">return</span> idx==0?_camLeft:_camRight;}</div><div class="line">    <span class="keyword">virtual</span> SE3    getCameraPose(<span class="keywordtype">int</span> idx)<span class="keyword"> const</span>{<span class="keywordflow">return</span> idx==0?_c2bLeft:_c2bRight;}</div><div class="line"></div><div class="line">    GImage       _imgRight;</div><div class="line">    Camera       _camRight;</div><div class="line">    SE3          _c2bRight;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">class </span>DatasetEuroc : <span class="keyword">public</span> Dataset{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    DatasetEuroc():curID(1){}</div><div class="line">    <span class="keyword">virtual</span> std::string type()<span class="keyword"> const</span>{<span class="keywordflow">return</span> <span class="stringliteral">&quot;DatasetEuroc&quot;</span>;}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span>        isOpened(){<span class="keywordflow">return</span> cam0.isValid()&amp;&amp;ifs0.is_open();}</div><div class="line"></div><div class="line">    <span class="keyword">static</span> std::string getFolderPath(<span class="keyword">const</span> std::string&amp; path) {</div><div class="line">      <span class="keyword">auto</span> idx = std::string::npos;</div><div class="line">      <span class="keywordflow">if</span> ((idx = path.find_last_of(<span class="charliteral">&#39;/&#39;</span>)) == std::string::npos)</div><div class="line">        idx = path.find_last_of(<span class="charliteral">&#39;\\&#39;</span>);</div><div class="line">      <span class="keywordflow">if</span> (idx != std::string::npos)</div><div class="line">        <span class="keywordflow">return</span> path.substr(0, idx);</div><div class="line">      <span class="keywordflow">else</span></div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> std::string getBaseName(<span class="keyword">const</span> std::string&amp; path) {</div><div class="line">      std::string filename = getFileName(path);</div><div class="line">      <span class="keyword">auto</span> idx = filename.find_last_of(<span class="charliteral">&#39;.&#39;</span>);</div><div class="line">      <span class="keywordflow">if</span> (idx == std::string::npos)</div><div class="line">        <span class="keywordflow">return</span> filename;</div><div class="line">      <span class="keywordflow">else</span></div><div class="line">        <span class="keywordflow">return</span> filename.substr(0, idx);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> std::string getFileName(<span class="keyword">const</span> std::string&amp; path) {</div><div class="line">      <span class="keyword">auto</span> idx = std::string::npos;</div><div class="line">      <span class="keywordflow">if</span> ((idx = path.find_last_of(<span class="charliteral">&#39;/&#39;</span>)) == std::string::npos)</div><div class="line">        idx = path.find_last_of(<span class="charliteral">&#39;\\&#39;</span>);</div><div class="line">      <span class="keywordflow">if</span> (idx != std::string::npos)</div><div class="line">        <span class="keywordflow">return</span> path.substr(idx + 1);</div><div class="line">      <span class="keywordflow">else</span></div><div class="line">        <span class="keywordflow">return</span> path;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span>        open(<span class="keyword">const</span> std::string&amp; dataset)</div><div class="line">    {</div><div class="line">        dirtop=getFolderPath(dataset);</div><div class="line">        std::string basename=getBaseName(dataset);</div><div class="line">        <span class="comment">// load camera data</span></div><div class="line">        checkHeader(dirtop+<span class="stringliteral">&quot;/cam0/sensor.yaml&quot;</span>);</div><div class="line">        checkHeader(dirtop+<span class="stringliteral">&quot;/cam1/sensor.yaml&quot;</span>);</div><div class="line"></div><div class="line">        cv::FileStorage cam0Sensor(dirtop+<span class="stringliteral">&quot;/cam0/sensor.yaml&quot;</span>, cv::FileStorage::READ);</div><div class="line">        cv::FileStorage cam1Sensor(dirtop+<span class="stringliteral">&quot;/cam1/sensor.yaml&quot;</span>, cv::FileStorage::READ);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(!cam0Sensor.isOpened()&amp;&amp;!cam1Sensor.isOpened())</div><div class="line">        {</div><div class="line">            LOG(ERROR)&lt;&lt;<span class="stringliteral">&quot;Can&#39;t load camera sensor data in folder&quot;</span>&lt;&lt;dirtop&lt;&lt;<span class="stringliteral">&quot;.&quot;</span>;</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        cam0 =loadCamera(cam0Sensor);</div><div class="line">        <span class="keywordflow">if</span>(basename!=<span class="stringliteral">&quot;mono&quot;</span>&amp;&amp;basename!=<span class="stringliteral">&quot;Monocular&quot;</span>)</div><div class="line">            cam1 =loadCamera(cam1Sensor);</div><div class="line"></div><div class="line">        cam0P=loadPose(cam0Sensor);</div><div class="line">        cam1P=loadPose(cam1Sensor);</div><div class="line"></div><div class="line">        ifs0.open(dirtop+<span class="stringliteral">&quot;/cam0/data.csv&quot;</span>);</div><div class="line">        ifs1.open(dirtop+<span class="stringliteral">&quot;/cam1/data.csv&quot;</span>);</div><div class="line">        std::string line;</div><div class="line">        <span class="keywordflow">if</span>(ifs0.is_open()) getline(ifs0,line);</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(ifs1.is_open()) getline(ifs1,line);</div><div class="line"></div><div class="line">        checkHeader(dirtop+<span class="stringliteral">&quot;/imu0/sensor.yaml&quot;</span>);</div><div class="line">        cv::FileStorage imu0Sensor(dirtop+<span class="stringliteral">&quot;/imu0/sensor.yaml&quot;</span>, cv::FileStorage::READ);</div><div class="line">        <span class="keywordflow">if</span>(!imu0Sensor.isOpened()) {</div><div class="line">            LOG(ERROR)&lt;&lt;<span class="stringliteral">&quot;Can&#39;t load imu sensor data.&quot;</span>;</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        imu0P=loadPose(imu0Sensor);</div><div class="line">        loadIMUNoise(imu0Sensor,gyrNoise,accNoise);</div><div class="line"></div><div class="line">        ifsIMU.open(dirtop+<span class="stringliteral">&quot;/imu0/data.csv&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">//        LOG(INFO)&lt;&lt;&quot;CAM0: &quot;&lt;&lt;cam0.info()&lt;&lt;&quot;,&quot;&lt;&lt;cam0P</span></div><div class="line"><span class="comment">//                &lt;&lt;&quot;\nCAM1: &quot;&lt;&lt;cam1.info()&lt;&lt;&quot;,&quot;&lt;&lt;cam1P</span></div><div class="line"><span class="comment">//               &lt;&lt;&quot;\nIMU0: &quot;&lt;&lt;imu0P&lt;&lt;&quot;,Noise: gyr[&quot;&lt;&lt;gyrNoise&lt;&lt;&quot;],acc[&quot;&lt;&lt;accNoise&lt;&lt;&quot;]&quot;;</span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(ifsIMU.is_open()) getline(ifsIMU,line);</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        nextImageFrame=grabImageFrame();</div><div class="line">        nextIMUFrame  =grabIMUFrame();</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> nextImageFrame&amp;&amp;nextIMUFrame;</div><div class="line">    }</div><div class="line"></div><div class="line">    Camera loadCamera(cv::FileStorage&amp; fs){</div><div class="line">        cv::FileNode wh=fs[<span class="stringliteral">&quot;resolution&quot;</span>];</div><div class="line">        cv::FileNode k=fs[<span class="stringliteral">&quot;intrinsics&quot;</span>];</div><div class="line">        cv::FileNode d=fs[<span class="stringliteral">&quot;distortion_coefficients&quot;</span>];</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(wh.isNone()||k.isNone()) <span class="keywordflow">return</span> Camera();</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> Camera({wh[0],wh[1],k[0],k[1],k[2],k[3],</div><div class="line">                              d[0],d[1],d[2],d[3],0.});</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span>   checkHeader(std::string file){</div><div class="line">        <span class="keyword">using namespace </span>std;</div><div class="line">        std::ifstream ifs(file.c_str());</div><div class="line">        <span class="keywordflow">if</span>(!ifs.is_open()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        std::vector&lt;std::string&gt; lines;</div><div class="line">        std::string line;</div><div class="line">        <span class="keywordflow">if</span>(getline(ifs,line)&amp;&amp;line==<span class="stringliteral">&quot;%YAML:1.0&quot;</span>) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">while</span>(getline(ifs,line)) lines.push_back(line);</div><div class="line">        ifs.close();</div><div class="line"></div><div class="line">        std::ofstream ofs(file.c_str());</div><div class="line">        ofs&lt;&lt;<span class="stringliteral">&quot;%YAML:1.0\n&quot;</span>;</div><div class="line">        <span class="keywordflow">for</span>(<span class="keyword">auto</span> line:lines) ofs&lt;&lt;line&lt;&lt;endl;</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    SE3    loadPose(cv::FileStorage&amp; fs){</div><div class="line">        cv::FileNode T_BS=fs[<span class="stringliteral">&quot;T_BS&quot;</span>];</div><div class="line">        <span class="keywordflow">if</span>(T_BS.isNone()) <span class="keywordflow">return</span> SE3();</div><div class="line"></div><div class="line">        cv::FileNode m=T_BS[<span class="stringliteral">&quot;data&quot;</span>];</div><div class="line">        <span class="keywordflow">if</span>(m.isNone()) <span class="keywordflow">return</span> SE3();</div><div class="line">        <span class="keywordtype">double</span> M[12]={m[0],m[1],m[2],m[3],</div><div class="line">                      m[4],m[5],m[6],m[7],</div><div class="line">                      m[8],m[9],m[10],m[11]};</div><div class="line">        SE3 pose;</div><div class="line">        pose.<a class="code" href="classGSLAM_1_1SE3__.html#a7038582e55af2c014094a75b13f95250">fromMatrix</a>(M);</div><div class="line">        <span class="keywordflow">return</span> pose;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> loadIMUNoise(cv::FileStorage&amp; fs,Point3d&amp; gyrNoise,Point3d&amp; accNoise){</div><div class="line">        <span class="keywordtype">double</span>  gyroscope_noise_density,gyroscope_random_walk,</div><div class="line">                accelerometer_noise_density,accelerometer_random_walk;</div><div class="line">        fs[<span class="stringliteral">&quot;gyroscope_noise_density&quot;</span>]&gt;&gt;gyroscope_noise_density;</div><div class="line">        fs[<span class="stringliteral">&quot;gyroscope_random_walk&quot;</span>]&gt;&gt;gyroscope_random_walk;</div><div class="line">        fs[<span class="stringliteral">&quot;accelerometer_noise_density&quot;</span>]&gt;&gt;accelerometer_noise_density;</div><div class="line">        fs[<span class="stringliteral">&quot;accelerometer_random_walk&quot;</span>]&gt;&gt;accelerometer_random_walk;</div><div class="line">        gyrNoise=Point3d(gyroscope_noise_density,gyroscope_random_walk,0);</div><div class="line">        accNoise=Point3d(accelerometer_noise_density,accelerometer_random_walk,0);</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    GSLAM::FramePtr grabIMUFrame(){</div><div class="line">        std::string line;</div><div class="line">        <span class="keywordtype">double</span>      time,rx,ry,rz,ax,ay,az;</div><div class="line">        <span class="keywordflow">if</span>(!std::getline(ifsIMU,line)) <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line">        sscanf(line.c_str(),<span class="stringliteral">&quot;%lf,%lf,%lf,%lf,%lf,%lf,%lf&quot;</span>,</div><div class="line">               &amp;time,&amp;rx,&amp;ry,&amp;rz,&amp;ax,&amp;ay,&amp;az);</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> GSLAM::FramePtr(<span class="keyword">new</span> FrameIMUEuroc(curID++,time*1e-9,Point3d(ax,ay,az),Point3d(rx,ry,rz),accNoise,gyrNoise,imu0P));</div><div class="line">    }</div><div class="line"></div><div class="line">    GSLAM::FramePtr grabImageFrame(){</div><div class="line">        std::string line;</div><div class="line">        <span class="keywordflow">if</span>(!std::getline(ifs0,line)) <span class="keywordflow">return</span> GSLAM::FramePtr();</div><div class="line"></div><div class="line">        <span class="keywordtype">int</span> idx=line.find_first_of(<span class="charliteral">&#39;,&#39;</span>);</div><div class="line">        <span class="keywordflow">if</span>(idx==std::string::npos) <span class="keywordflow">return</span> GSLAM::FramePtr();</div><div class="line">        <span class="keywordtype">double</span> nextImageTime=std::stod(line.substr(0,idx))*1e-9;</div><div class="line">        std::string nextImage=line.substr(0,idx)+<span class="stringliteral">&quot;.png&quot;</span>;</div><div class="line"></div><div class="line">        <a class="code" href="classGSLAM_1_1GImage.html">GSLAM::GImage</a> img0=cv::imread(dirtop+<span class="stringliteral">&quot;/cam0/data/&quot;</span>+nextImage);</div><div class="line">        <span class="keywordflow">if</span>(img0.empty())</div><div class="line">            LOG(ERROR)&lt;&lt;<span class="stringliteral">&quot;Failed to open image &quot;</span>&lt;&lt;nextImage;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(cam1.isValid()){</div><div class="line">            <a class="code" href="classGSLAM_1_1GImage.html">GSLAM::GImage</a> img1=cv::imread(dirtop+<span class="stringliteral">&quot;/cam1/data/&quot;</span>+nextImage);</div><div class="line">            <span class="keywordflow">return</span> FramePtr(<span class="keyword">new</span> FrameStereoEuroc(curID++,nextImageTime,img0,img1,cam0,cam1,cam0P,cam1P));</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> FramePtr(<span class="keyword">new</span> FrameMonoEuroc(curID++,nextImageTime,img0,cam0,cam0P));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> GSLAM::FramePtr grabFrame(){</div><div class="line">        <span class="keywordflow">if</span>(!nextImageFrame||!nextIMUFrame) <span class="keywordflow">return</span> FramePtr();</div><div class="line">        GSLAM::FramePtr result;</div><div class="line">        <span class="keywordflow">if</span>(nextImageFrame-&gt;timestamp()&lt;nextIMUFrame-&gt;timestamp()){</div><div class="line">            result=nextImageFrame;</div><div class="line">            nextImageFrame=grabImageFrame();</div><div class="line"><span class="comment">//            LOG(INFO)&lt;&lt;&quot;Frame:&quot;&lt;&lt;result-&gt;timestamp();</span></div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            result=nextIMUFrame;</div><div class="line">            nextIMUFrame=grabIMUFrame();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> result;</div><div class="line">    }</div><div class="line"></div><div class="line">    std::string    dirtop;</div><div class="line">    <a class="code" href="classGSLAM_1_1Camera.html">GSLAM::Camera</a>  cam0,cam1;</div><div class="line">    <a class="code" href="classGSLAM_1_1SE3__.html">GSLAM::SE3</a>     cam0P,cam1P,imu0P;<span class="comment">// Treat IMU as body</span></div><div class="line">    Point3d        gyrNoise,accNoise;</div><div class="line">    std::ifstream  ifs0,ifs1,ifsIMU;</div><div class="line"></div><div class="line">    GSLAM::FrameID curID;</div><div class="line">    FramePtr       nextImageFrame,nextIMUFrame;</div><div class="line">};</div><div class="line"></div><div class="line">GSLAM_REGISTER_DATASET(DatasetEuroc,euroc);</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
